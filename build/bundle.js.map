{"version":3,"sources":["webpack:///webpack/bootstrap ce6cc1cb257e6f86b19d","webpack:///./index.ts"],"names":[],"mappings":"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","file":"./build/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap ce6cc1cb257e6f86b19d\n **/","// pointer info (offset, pressure)\ninterface InkRenderingSegment {\n  x: number,\n  y: number,\n  pressure: number,\n  mode: 'ink' | 'eraser',\n}\n\nconst π = Math.PI;\n\nconst inkLayer = document.querySelector('canvas.ink-layer') as HTMLCanvasElement;\n// drawing eraser marker with DOM at nearly 60times/sec is too heavy task, so\n// use canvas instead\n// const eraserMarker = document.querySelector('.canvas-eraser-marker') as HTMLDivElement;\nconst markerLayer = document.querySelector('canvas.marker-layer') as HTMLCanvasElement;\nconst saveButton = document.querySelector('a.save-button') as HTMLAnchorElement;\n\nwindow.addEventListener('load', _ev => {\n  // adjust canvas size to fit window\n  const w = window.innerWidth, h = window.innerHeight;\n  inkLayer.width = w; inkLayer.height = h;\n  markerLayer.width = w; markerLayer.height = h;\n\n  // fill ink layer\n  const ctx = inkLayer.getContext('2d') !;\n  ctx.fillStyle = '#fff';\n  ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n});\n\nfunction formatDate(date: Date): string {\n  const YYYY = date.getFullYear();\n  const MM = ('0' + (date.getMonth() + 1)).slice(-2);\n  const DD = ('0' + date.getDate()).slice(-2);\n  const hh = ('0' + date.getHours()).slice(-2);\n  const mm = ('0' + date.getMinutes()).slice(-2);\n  const ss = ('0' + date.getSeconds()).slice(-2);\n  return `${YYYY}-${MM}-${DD} ${hh}-${mm}-${ss}`;\n}\n\nsaveButton.addEventListener('click', ev => {\n  ev.preventDefault();\n\n  const defaultName = formatDate(new Date()) + '.png';\n\n  // download PNG\n  if (window.navigator.msSaveBlob) { // for Microsoft Edge\n    // new Promise<Blob>((resolve, reject) => {\n    const blob = inkLayer.msToBlob();\n    // inkLayer.toBlob(blob => {\n    if (!blob) {\n      console.error(\"[canvas] failed to create Blob\");\n      return;\n    }\n    window.navigator.msSaveBlob(blob, defaultName);\n    // if (blob) { resolve(blob); }\n    // else { reject(); }\n    // });\n    // }).then(blob=>{})\n  } else { // for Google Chrome\n    const dataUrl = inkLayer.toDataURL();\n    const a = document.createElement('a');\n    // const e = document.createEvent('MouseEvent');\n    a.href = dataUrl;\n    a.download = formatDate(new Date()) + '.png';\n    a.type = 'image/png';\n    // e.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, a);\n    // a.dispatchEvent(e);\n    a.click();\n  }\n});\n\nconst eraserButton = 32; // 6th button\nconst penPressureSensitivity = 5;\nconst eraserPressureSensitivity = 100;\nconst penStyle = '#001128'; // LAMY blue black ink\nconst eraserStyle = '#fff';\n\n// pointer info buffer\nlet inkStroke = [] as Array<InkRenderingSegment>;\n// for requestAnimationFrame\nlet requestID: number;\n\n// stat\nlet pointerCount = 0;\nlet drawCount = 0;\n\nconst isEraser = (ev: PointerEvent) => (ev.buttons | eraserButton) === ev.buttons;\n\ninkLayer.addEventListener('pointerdown', ev => {\n  if (ev.pointerType !== 'pen' || ev.pressure === 0) { return; }\n  ev.preventDefault();\n\n  const rect = (ev.target as HTMLCanvasElement).getBoundingClientRect();\n  console.assert(ev.offsetX === ev.clientX - rect.left, \"The value of ev.offsetX is invalid\");\n\n  inkStroke = []; // clear buffer\n  inkStroke.push({\n    x: ev.offsetX,\n    y: ev.offsetY,\n    pressure: ev.pressure,\n    mode: isEraser(ev) ? 'eraser' : 'ink',\n  });\n\n  requestID = requestAnimationFrame(draw); // request for draw loop\n});\n\ninkLayer.addEventListener('pointermove', ev => {\n  if (ev.pointerType !== 'pen' || ev.pressure === 0) { return; }\n  ev.preventDefault();\n\n  inkStroke.push({\n    x: ev.offsetX,\n    // x: ev.clientX - rect.left,\n    y: ev.offsetY,\n    // y: ev.clientY - rect.top,\n    pressure: ev.pressure,\n    // if the 6th button is pressed, switch to eraser\n    mode: isEraser(ev) ? 'eraser' : 'ink',\n  });\n});\n\ninkLayer.addEventListener('pointerup', ev => {\n  if (ev.pointerType !== 'pen') { return; }\n  ev.preventDefault();\n\n  inkStroke = []; // clear buffer\n  cancelAnimationFrame(requestID); // break draw loop (for less CPU consumption)\n  console.log(`[pointerup] average pointer count: ${pointerCount / drawCount}`);\n  pointerCount = 0; drawCount = 0;\n});\n\ninkLayer.addEventListener('pointerleave', ev => {\n  if (ev.pointerType !== 'pen') { return; }\n  ev.preventDefault();\n\n  inkStroke = []; // clear buffer\n  cancelAnimationFrame(requestID); // break draw loop (for less CPU consumption)\n});\n\n// canvas draw loop\nfunction draw() {\n  // if buffer count equals 0 or 1, do nothing\n  if (inkStroke.length > 1) {\n    const inkCtx = inkLayer.getContext('2d') !;\n    const markerCtx = markerLayer.getContext('2d') !;\n    const {x, y, pressure, mode} = inkStroke[0];\n\n    switch (mode) {\n      case 'ink':\n        inkCtx.strokeStyle = penStyle;\n        inkCtx.lineWidth = pressure * penPressureSensitivity;\n        inkCtx.lineCap = 'round';\n\n        inkCtx.beginPath();\n        inkCtx.moveTo(x, y);\n        for (const p of inkStroke.slice(1)) {\n          inkCtx.lineTo(p.x, p.y);\n        }\n        inkCtx.stroke();\n\n        // clear eraser marker\n        markerCtx.clearRect(0, 0, markerCtx.canvas.width, markerCtx.canvas.height);\n        break;\n\n      case 'eraser':\n        let width = pressure * eraserPressureSensitivity;\n        inkCtx.fillStyle = eraserStyle;\n\n        inkCtx.beginPath();\n        for (const p of inkStroke) {\n          const radius = p.pressure * eraserPressureSensitivity / 2;\n          inkCtx.ellipse(x, y, radius, radius, 0, 0, 2 * π);\n          inkCtx.fill();\n        }\n\n        // draw eraser marker\n        markerCtx.strokeStyle = '#888';\n        markerCtx.setLineDash([4, 4]);\n        markerCtx.lineWidth = 2;\n\n        markerCtx.clearRect(0, 0, markerCtx.canvas.width, markerCtx.canvas.height);\n        markerCtx.beginPath();\n        markerCtx.ellipse(x, y, width / 2, width / 2, 0, 0, 2 * π);\n        markerCtx.stroke();\n        break;\n    }\n\n    pointerCount += inkStroke.length - 1;\n    drawCount += 1;\n\n    inkStroke = [inkStroke[inkStroke.length - 1]]; // create new buffer with last element\n  }\n\n  requestID = requestAnimationFrame(draw); // continue draw loop\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./index.ts\n **/"],"sourceRoot":""}